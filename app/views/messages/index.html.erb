<p id="notice"><%= notice %></p>

<h4>View Contacts</h4>
<%= params[:my_id]%>

<% @receiver_user = User.find(params[:my_id]) %>
<% if @receiver_user.has_role? :candidate %>
  <% @receiver = @receiver_user.profile %>
<% elsif @receiver_user.has_role? :host %>
  <% @receiver = @receiver_user.org_user_profile %>
<% end %>

<!-- Check the contacts from all messages to see if contact id is new and will be added into the connections list -->
<% @messages.each do |message| %>
  <% if (message.from == params[:my_id].to_i) || (message.to == params[:my_id].to_i) %>
    <!-- save the new contact that send me the message -->
    <% if (message.from != current_user.id) && !(@receiver.connections.include?(message.from))%>
      <!-- do not save my own id into my connections list AND -->
      <!-- add receiver user id if it is a new connection -->
      <% @receiver.connections << message.from %>
      <% @receiver.save! %>
    <% end %>
    <!-- save the new contact that I send the message to -->
    <% if (message.to != current_user.id) && !(@receiver.connections.include?(message.to))%>
      <!-- do not save my own id into my connections list AND -->
      <!-- add receiver user id if it is a new connection -->
      <% @receiver.connections << message.to %>
      <% @receiver.save! %>
    <% end %>
  <% end %>

  <!-- <tr>
    <td><%#= message.user %></td>
    <td><%#= message.opportunity %></td>
    <td><%#= message.from %></td>
    <td><%#= message.to %></td>
    <td><%#= message.message_text %></td>
    <td><%#= message.status %></td>
    <td><%#= message.attachment %></td>
    <td><%#= link_to 'Show', message %></td>
    <td><%#= link_to 'Edit', edit_message_path(message) %></td>
    <td><%#= link_to 'Destroy', message, method: :delete, data: { confirm: 'Are you sure?' } %></td>
  </tr> -->


<% end %><!-- end of @messages loop -->
<br><br>



<% @messages.each do |message| %>
  <tr>
    user id: <td><%= message.user.id %></td>
    title: <td><%= message.opportunity.title %></td>
    from: <td><%= message.from %></td>
    to: <td><%= message.to %></td>
    <td><%= message.message_text %></td>
    <td><%= message.status %></td>
    <td><%= message.attachment %></td>
    <td><%= link_to 'Show', message %></td>
    <td><%= link_to 'Edit', edit_message_path(message) %></td>
    <td><%= link_to 'Destroy', message, method: :delete, data: { confirm: 'Are you sure?' } %></td>
  </tr>
<% end %>
<br>

<%= link_to 'New Message', new_message_path %>
